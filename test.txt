*** Settings ***

Library  Selenium2Library  timeout=15  implicit_wait=0.1

Library  OperatingSystem

Library  compare.py

Suite Setup  Start app and Open Browser

Suite Teardown  Close All Browsers and Processes


*** Variables ***

${PORT} =  8080
${DOMAIN} =  0.0.0.0
${APP_URL} =  http://${DOMAIN}:${PORT}
${base_path} =  app/static/img/
${base_login} =  ${base_path}login.png
${base_mypage} =  ${base_path}mypage.png
${base_projects} =  ${base_path}projects.png
${base_companies} =  ${base_path}companies.png
${base_time_report} =  ${base_path}time_report.png
${base_todos} =  ${base_path}todos.png
${base_people} =  ${base_path}people.png

${BROWSER} =  Firefox
${REMOTE_URL} =
${DESIRED_CAPABILITIES} =  platform:Linux
${BUILD_NUMBER} =  manual
${SESSION_ID} =
${TEST_NAME} =  General


*** Test Cases ***

Test App
    Location should contain  login
    Page should contain  BB
    Title should be  BB

Test Login Page
    Location should contain  login
    Page should contain  Please enter you credentials
    Page should contain element  name=subdomain
    Page should contain element  name=username
    Page should contain element  name=password
#    Capture Page Screenshot  login.png
#    Compare screenshot to base  ${base_login}
    Input Text  name=subdomain  test
    Click button  Log in
    Page should contain  Please enter all fields!
    Input Text  name=username  test
    Click button  Log in
    Page should contain  Please enter all fields!
    Input Password  name=password  test
    Click button  Log in
    Wait Until Page Contains  First Last
    Test user logout

Test Nav Pages
    Test user login
    Click link  Projects
    Location should be  ${APP_URL}/#projects
#    Capture Page Screenshot  projects.png
#    Compare screenshot to base  ${base_projects}
    Click link  Companies
    Location should be  ${APP_URL}/#companies
#    Capture Page Screenshot  companies.png
#    Compare screenshot to base  ${base_companies}
    Click link  To-Dos
    Location should be  ${APP_URL}/#todos
#    Capture Page Screenshot  todos.png
#    Compare screenshot to base  ${base_todos}
    Click link  Time
    Location should be  ${APP_URL}/#time_report
#    Capture Page Screenshot  time_report.png
#    Compare screenshot to base  ${base_time_report}
    Click link  People
    Location should be  ${APP_URL}/#people
#    Capture Page Screenshot  people.png
#    Compare screenshot to base  ${base_people}
    Test user logout

Test Projects Page
    Test user login
    Click link  Projects
    Click link  active
    Sleep  0.5
    Click element  xpath=//*[@id="projects_active"]//a[contains(text(),"Company name #1")]
    Sleep  0.5
    Element Should Be Visible  link=Name of #15
    Element Should Not Be Visible  link=Name of #10
    Element Should Not Be Visible  link=Name of #5
    Click link  on_hold
    Sleep  0.5
    Click element  xpath=//*[@id="projects_on_hold"]//a[contains(text(),"Company name #1")]
    Sleep  0.5
    Element Should Not Be Visible  link=Name of #15
    Element Should Be Visible  link=Name of #10
    Element Should Not Be Visible  link=Name of #5
    Click link  archived
    Sleep  0.5
    Click element  xpath=//*[@id="projects_archived"]//a[contains(text(),"Company name #1")]
    Sleep  0.5
    Element Should Not Be Visible  link=Name of #15
    Element Should Not Be Visible  link=Name of #10
    Element Should Be Visible  link=Name of #5
    Test user logout

Test My Profile
    Test user login
    Click link  First Last
    Click link  My profile
    Location should be  ${APP_URL}/#me
    Page should contain element  link=name@domain.com
    Page should contain element  link=example
    Page should contain  Mobile phone: +000 (00) 000-0000
    Page should contain  Home phone: +000 (00) 000-0001
    Page should contain  Fax phone: +000 (00) 000-0002
    Page should contain  Office phone: +000 (00) 000-0003
    Page should contain  Time zone: Europe/Kiev
#    Capture Page Screenshot  mypage.png
#    Compare screenshot to base  ${base_mypage}
    Test user logout


*** Keywords ***

Start app and Open Browser
    Start Process  bin/dev_appserver app --skip_sdk_update_check -a 0.0.0.0
    Sleep  1
#    Open browser  ${APP_URL}
    Start browser
#    Maximize browser window

Close All Browsers and Processes
    Report test status
    Close All Browsers
    Run  pkill -f dev_appserver
    Stop All Processes

Test user login
    Location should contain  login
    Input Text  name=subdomain  test
    Input Text  name=username  test
    Input Password  name=password  test
    Click button  Log in
    Wait Until Page Contains  First Last

Test user logout
    Click link  First Last
    Click link  Logout
    Click link  log in

Start browser
    ${BROWSER} =  Get Environment Variable  ROBOT_BROWSER  ${BROWSER}
    ${REMOTE_URL} =  Get Environment Variable  ROBOT_REMOTE_URL  ${REMOTE_URL}
    ${BUILD_NUMBER} =  Get Environment Variable  ROBOT_BUILD_NUMBER  ${BUILD_NUMBER}
    ${DESIRED_CAPABILITIES} =  Get Environment Variable  ROBOT_DESIRED_CAPABILITIES  ${DESIRED_CAPABILITIES}
    ${BUILD_INFO} =  Set variable  build:${BUILD_NUMBER},name:${SUITE_NAME} | ${TEST_NAME}
    Open browser  ${APP_URL}  ${BROWSER}  remote_url=${REMOTE_URL}  desired_capabilities=${DESIRED_CAPABILITIES},${BUILD_INFO}
    Run keyword and ignore error  Set session id

Set session id
    Keyword should exist  Get session id
    ${SESSION_ID} =  Get session id
    Set test variable  ${SESSION_ID}  ${SESSION_ID}

Report test status
    Run keyword unless  '${SESSION_ID}' == ''
    ...     Report sauce status  ${SESSION_ID}  ${TEST_STATUS}  ${TEST_TAGS}