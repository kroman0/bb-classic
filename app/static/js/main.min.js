!function(e,t){"use strict";if(typeof e.define==="function"&&e.define.amd){e.define("bbmain",["jquery","underscore","backbone","bbgeneral","bbmodels","bbcollections","bbviews","backboneanalytics"],t)}else{e.BB=t(e.jQuery,e._,e.Backbone,e.bbgeneral,e.bbmodels,e.bbcollections,e.bbviews)}}(this,function(e,t,o,r,c,n,i){"use strict";var s,p={},d={},_={},m=r.onReset,a={el:".content",collections:d},l,j,w,u=o.Router.extend({routes:{projects:"projects","projects:tab":"projects","projects/:id":"project","projects/:id/todo_lists":"project_todo_lists","projects/:id/todo_lists/:tlid":"project_todo_list","projects/:id/todo_lists/:tlid/:tiid":"project_todo_item","projects/:id/todo_lists/:tlid/:tiid/comments":"project_todo_item_comments","projects/:id/time_entries/todo_items/:tiid":"todo_time_entries","projects/:id/time_entries":"project_time_entries","projects/:id/people":"project_people","projects/:id/posts":"project_posts","projects/:id/posts/:pid":"project_post","projects/:id/posts/:pid/comments":"project_post_comments","projects/:id/files":"project_files","projects/:id/files/:fid":"project_file","projects/:id/calendar":"project_calendar","projects/:id/calendar/:cid":"project_calendar_entry","projects/:id/calendar/:cid/comments":"project_calendar_entry_comments","projects/:id/categories":"project_categories","projects/:id/categories/:cid":"project_category",companies:"companies","companies/:id":"company",people:"people","people:tab":"people","people/:id":"person",me:"me",todos:"todos",time_report:"time_report","*actions":"defaultRoute"}}),f=new u;p.mydata=new c.MyModel;p.project=new c.Project;p.company=new c.Company;p.person=new c.Person;d.projects=new n.Projects;d.companies=new n.Companies;d.people=new n.People;d.todos=new n.TodoLists;d.times=new n.TimeEntries;_.current=null;_.projects=new i.ProjectsView(t.extend({collection:d.projects},a));_.companies=new i.CompaniesView(t.extend({collection:d.companies},a));_.people=new i.AllPeopleView(t.extend({collection:d.people},a));_.time_report=new i.TimeReportView(t.extend({collection:d.times},a));_.todos=new i.TodosView(t.extend({collection:d.todos,mydata:p.mydata},a));for(s in d){if(d.hasOwnProperty(s)){d[s].on("reset",m)}}d.project_people=new n.People;d.project_categories=new n.Categories;d.project_posts=new n.Posts;d.project_files=new n.Attachments;d.project_todo_lists=new n.TodoLists;d.project_calendar=new n.Calendar;d.project_time_entries=new n.TimeEntries;d.todo_items=new n.TodoItems;d.todo_time_entries=new n.TodoTimeEntries;d.project_todo_item_comments=new n.TodoComments;d.project_post_comments=new n.PostComments;d.project_calendar_entry_comments=new n.CalendarEntryComments;_.company_view=new i.CompanyView(t.extend({model:p.company},a));_.person_view=new i.PersonView(t.extend({model:p.person},a));l=t.extend({model:p.project},a);_.project_view=new i.ProjectView(l);_.project_people=new i.PeopleView(l);_.project_categories=new i.CategoriesView(l);_.project_category=new i.CategoryView(l);_.project_posts=new i.PostsView(l);_.project_post=new i.PostView(l);_.project_calendar=new i.CalendarView(l);_.project_calendar_entry=new i.CalendarEntryView(l);_.project_files=new i.FilesView(l);_.project_file=new i.FileView(l);w=t.extend({mydata:p.mydata},l);_.project_time_entries=new i.TimeEntriesView(w);_.todo_time_entries=new i.TodoTimeEntriesView(w);_.project_post_comments=new i.PostCommentsView(l);_.project_calendar_entry_comments=new i.CalendarEntryCommentsView(l);_.todo=function(e,t){if(!_.todo[t.id]){_.todo[t.id]=new i.TodoView({model:t,collections:d,project_id:e})}return _.todo[t.id]};j=t.extend({todo:_.todo},l);_.project_todo_lists=new i.TodoListsView(j);_.project_todo_list=new i.TodoListView(j);_.project_todo_item=new i.TodoItemView(j);_.project_todo_item_comments=new i.TodoItemCommentsView(j);f.on("route",function(o,r){var c,n;if(t.contains(["projects","companies","people","time_report","todos"],o)){_.current=_[o].render()}else if(t.contains(["project_people","project_categories","project_time_entries","project_posts","project_files","project_calendar","project_todo_lists"],o)){c=parseInt(r[0],10);if(d.projects.get(c)){_[o].model=d.projects.get(c)}else{_[o].model.id=c}_[o].collection=d[o].get_or_create(c);_.current=_[o].render()}else if(t.contains(["project_post","project_file","project_calendar_entry","project_category","project_todo_list","project_calendar_entry_comments","project_post_comments","todo_time_entries"],o)){c=parseInt(r[0],10);n=parseInt(r[1],10);if(d.projects.get(c)){_[o].model=d.projects.get(c)}else{_[o].model.id=c}_[o].cur_item=n;switch(o){case"project_calendar_entry":_[o].collection=d.project_calendar.get_or_create(c);break;case"project_category":_[o].collection=d.project_categories.get_or_create(c);break;case"project_post":case"project_file":case"project_todo_list":_[o].collection=d[o+"s"].get_or_create(c);break;default:_[o].collection=d[o].get_or_create(n)}_.current=_[o].render()}if(_.current){document.title=_.current.PageTitle()}if(_.current&&_.current.deps){_.current.deps()}e(t.filter(e(".navbar ul.nav li").removeClass("active"),function(t){return e(t).find("a:visible")[0]&&document.location.hash.indexOf(e(t).find("a:visible")[0].hash)!==-1})).addClass("active");e(t.filter(e("div.content ul.projectnav li").removeClass("active"),function(t){return e(t).find("a:visible")[0]&&document.location.hash.indexOf(e(t).find("a:visible")[0].hash)!==-1})).filter(":last").addClass("active")}).on("route:project_todo_item",function(e,t,o){if(d.projects.get(e)){_.project_todo_item.model=d.projects.get(e)}else{_.project_todo_item.model.id=e}_.project_todo_item.cur_item=t;_.project_todo_item.todo_item=o;_.project_todo_item.collection=d.project_todo_lists.get_or_create(e);_.current=_.project_todo_item.render()}).on("route:project_todo_item_comments",function(e,t,o){if(d.projects.get(e)){_.project_todo_item_comments.model=d.projects.get(e)}else{_.project_todo_item_comments.model.id=e}_.project_todo_item_comments.cur_item=t;_.project_todo_item_comments.todo_item=o;_.project_todo_item_comments.todo_lists=d.project_todo_lists.get_or_create(e);_.project_todo_item_comments.collection=d.project_todo_item_comments.get_or_create(o);_.current=_.project_todo_item_comments.render()}).on("route:project",function(e){if(d.projects.get(e)){_.project_view.model=d.projects.get(e)}else{_.project_view.model.id=e}_.current=_.project_view.render()}).on("route:company",function(e){if(d.companies.get(e)){_.company_view.model=d.companies.get(e)}else{_.company_view.model.id=e}_.current=_.company_view.render()}).on("route:person",function(e){if(d.people.get(e)){_.person_view.model=d.people.get(e)}else{_.person_view.model.id=e}_.current=_.person_view.render()}).on("route:me",function(){_.person_view.model=p.mydata;_.current=_.person_view.render()}).on("route:defaultRoute",function(e){this.navigate("projects",{trigger:true})});_.navbar=new i.NavView({model:p.mydata,el:".navbar"}).render();p.mydata.once("sync",function(){o.history.start()});p.mydata.fetch();return{models:p,collections:d,views:_,workspace:f}});