!function(e,o){"use strict";"function"==typeof e.define&&e.define.amd?e.define("bbmain",["underscore","backbone","bbmodels","bbcollections","bbviews","backboneanalytics"],o):e.BB=o(e._,e.Backbone,e.bbmodels,e.bbcollections,e.bbviews)}(this,function(e,o,t,c,r){"use strict";var i=new t.MyModel,n={},s={},p={className:"content",mydata:i,collections:n},_=o.Router.extend({routes:{projects:"projects","projects:tab":"projects","projects/:id":"project","projects/:id/todo_lists":"project_todo_lists","projects/:id/todo_lists/:tlid":"project_todo_list","projects/:id/todo_lists/:tlid/:tiid":"project_todo_item","projects/:id/todo_lists/:tlid/:tiid/comments":"project_todo_item_comments","projects/:id/time_entries/todo_items/:tiid":"todo_time_entries","projects/:id/time_entries":"project_time_entries","projects/:id/people":"project_people","projects/:id/people/:pid":"project_person","projects/:id/posts":"project_posts","projects/:id/posts/:pid":"project_post","projects/:id/posts/:pid/comments":"project_post_comments","projects/:id/files":"project_files","projects/:id/files/:fid":"project_file","projects/:id/calendar":"project_calendar","projects/:id/calendar/:cid":"project_calendar_entry","projects/:id/calendar/:cid/comments":"project_calendar_entry_comments","projects/:id/categories":"project_categories","projects/:id/categories/:cid":"project_category",companies:"companies","companies/:id":"company",people:"people","people:tab":"people","people/:id":"person",me:"me",todos:"todos",time_report:"time_report","*actions":"defaultRoute"}}),d=function(e,o,t){return t.model=o.get(e)?o.get(e):new o.model({id:e}),t.model},m=function(e){o.$(".container").empty().append(e.el),e.render()},a=new _;return n.projects=new c.Projects,n.companies=new c.Companies,n.people=new c.People,n.todos=new c.TodoLists,n.times=new c.TimeEntries,s.projects=new r.ProjectsView(e.extend({collection:n.projects},p)),s.companies=new r.CompaniesView(e.extend({collection:n.companies},p)),s.people=new r.AllPeopleView(e.extend({collection:n.people},p)),s.time_report=new r.TimeReportView(e.extend({collection:n.times},p)),s.todos=new r.TodosView(e.extend({collection:n.todos},p)),n.project_people=new c.People,n.project_categories=new c.Categories,n.project_posts=new c.Posts,n.project_files=new c.Attachments,n.project_todo_lists=new c.TodoLists,n.project_calendar=new c.Calendar,n.project_time_entries=new c.TimeEntries,n.todo_items=new c.TodoItems,n.todo_time_entries=new c.TodoTimeEntries,n.project_todo_item_comments=new c.TodoComments,n.project_post_comments=new c.PostComments,n.project_calendar_entry_comments=new c.CalendarEntryComments,s.company_view=new r.CompanyView(p),s.person_view=new r.AllPersonView(p),s.project_view=new r.ProjectView(p),s.project_people=new r.PeopleView(p),s.project_person=new r.PersonView(p),s.project_categories=new r.CategoriesView(p),s.project_category=new r.CategoryView(p),s.project_posts=new r.PostsView(p),s.project_post=new r.PostView(p),s.project_calendar=new r.CalendarView(p),s.project_calendar_entry=new r.CalendarEntryView(p),s.project_files=new r.FilesView(p),s.project_file=new r.FileView(p),s.project_time_entries=new r.TimeEntriesView(p),s.todo_time_entries=new r.TodoTimeEntriesView(p),s.project_post_comments=new r.PostCommentsView(p),s.project_calendar_entry_comments=new r.CalendarEntryCommentsView(p),s.project_todo_lists=new r.TodoListsView(p),s.project_todo_list=new r.TodoListView(p),s.project_todo_item=new r.TodoItemView(p),s.project_todo_item_comments=new r.TodoItemCommentsView(p),a.on("route",function(o,t){var c,r;if(e.contains(["projects","companies","people","time_report","todos"],o))m(s[o]);else if(e.contains(["project_people","project_categories","project_time_entries","project_posts","project_files","project_calendar","project_todo_lists"],o))c=parseInt(t[0],10),d(c,n.projects,s[o]),s[o].collection=n[o].get_or_create(c),m(s[o]);else if(e.contains(["project_person","project_post","project_file","project_calendar_entry","project_category","project_todo_list","project_calendar_entry_comments","project_post_comments","todo_time_entries"],o)){switch(c=parseInt(t[0],10),r=parseInt(t[1],10),d(c,n.projects,s[o]),s[o].cur_item=r,o){case"project_person":s[o].collection=n.project_people.get_or_create(c);break;case"project_calendar_entry":s[o].collection=n.project_calendar.get_or_create(c);break;case"project_category":s[o].collection=n.project_categories.get_or_create(c);break;case"project_post":case"project_file":case"project_todo_list":s[o].collection=n[o+"s"].get_or_create(c);break;default:s[o].collection=n[o].get_or_create(r)}m(s[o])}}).on("route:project_todo_item",function(e,o,t){d(e,n.projects,s.project_todo_item),s.project_todo_item.cur_item=o,s.project_todo_item.todo_item=t,s.project_todo_item.collection=s.project_todo_item.todo_lists=n.project_todo_lists.get_or_create(e),m(s.project_todo_item)}).on("route:project_todo_item_comments",function(e,o,t){d(e,n.projects,s.project_todo_item_comments),s.project_todo_item_comments.cur_item=o,s.project_todo_item_comments.todo_item=t,s.project_todo_item_comments.todo_lists=n.project_todo_lists.get_or_create(e),s.project_todo_item_comments.collection=n.project_todo_item_comments.get_or_create(t),m(s.project_todo_item_comments)}).on("route:project",function(e){d(e,n.projects,s.project_view),m(s.project_view)}).on("route:company",function(e){d(e,n.companies,s.company_view),m(s.company_view)}).on("route:person",function(e){d(e,n.people,s.person_view),m(s.person_view)}).on("route:me",function(){s.person_view.model=i,m(s.person_view)}).on("route:defaultRoute",function(){this.navigate("projects",{trigger:!0})}),s.navbar=new r.NavView({model:i,el:".navbar"}).render(),i.once("sync",function(){o.history.start()}),i.fetch(),{mydata:i,collections:n,views:s,workspace:a}});