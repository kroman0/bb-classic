!function(e,o){"use strict";"function"==typeof e.define&&e.define.amd?e.define("bbmain",["jquery","underscore","backbone","bbgeneral","bbmodels","bbcollections","bbviews","backboneanalytics"],o):e.BB=o(e.jQuery,e._,e.Backbone,e.bbgeneral,e.bbmodels,e.bbcollections,e.bbviews)}(this,function(e,o,t,r,c,n,i){"use strict";var s,p,_,d,a={},m={},l={},j=r.onReset,w={el:".content",collections:m},u=t.Router.extend({routes:{projects:"projects","projects:tab":"projects","projects/:id":"project","projects/:id/todo_lists":"project_todo_lists","projects/:id/todo_lists/:tlid":"project_todo_list","projects/:id/todo_lists/:tlid/:tiid":"project_todo_item","projects/:id/todo_lists/:tlid/:tiid/comments":"project_todo_item_comments","projects/:id/time_entries/todo_items/:tiid":"todo_time_entries","projects/:id/time_entries":"project_time_entries","projects/:id/people":"project_people","projects/:id/people/:pid":"project_person","projects/:id/posts":"project_posts","projects/:id/posts/:pid":"project_post","projects/:id/posts/:pid/comments":"project_post_comments","projects/:id/files":"project_files","projects/:id/files/:fid":"project_file","projects/:id/calendar":"project_calendar","projects/:id/calendar/:cid":"project_calendar_entry","projects/:id/calendar/:cid/comments":"project_calendar_entry_comments","projects/:id/categories":"project_categories","projects/:id/categories/:cid":"project_category",companies:"companies","companies/:id":"company",people:"people","people:tab":"people","people/:id":"person",me:"me",todos:"todos",time_report:"time_report","*actions":"defaultRoute"}}),f=function(e,o,t){return o.get(e)?t.model=o.get(e):t.model.id=e,t.model},y=new u;a.mydata=new c.MyModel,a.project=new c.Project,a.company=new c.Company,a.person=new c.Person,m.projects=new n.Projects,m.companies=new n.Companies,m.people=new n.People,m.todos=new n.TodoLists,m.times=new n.TimeEntries,l.current=null,l.projects=new i.ProjectsView(o.extend({collection:m.projects},w)),l.companies=new i.CompaniesView(o.extend({collection:m.companies},w)),l.people=new i.AllPeopleView(o.extend({collection:m.people},w)),l.time_report=new i.TimeReportView(o.extend({collection:m.times},w)),l.todos=new i.TodosView(o.extend({collection:m.todos,mydata:a.mydata},w));for(s in m)m.hasOwnProperty(s)&&m[s].on("reset",j);return m.project_people=new n.People,m.project_categories=new n.Categories,m.project_posts=new n.Posts,m.project_files=new n.Attachments,m.project_todo_lists=new n.TodoLists,m.project_calendar=new n.Calendar,m.project_time_entries=new n.TimeEntries,m.todo_items=new n.TodoItems,m.todo_time_entries=new n.TodoTimeEntries,m.project_todo_item_comments=new n.TodoComments,m.project_post_comments=new n.PostComments,m.project_calendar_entry_comments=new n.CalendarEntryComments,l.company_view=new i.CompanyView(o.extend({model:a.company},w)),l.person_view=new i.AllPersonView(o.extend({model:a.person},w)),p=o.extend({model:a.project},w),l.project_view=new i.ProjectView(p),l.project_people=new i.PeopleView(p),l.project_person=new i.PersonView(p),l.project_categories=new i.CategoriesView(p),l.project_category=new i.CategoryView(p),l.project_posts=new i.PostsView(p),l.project_post=new i.PostView(p),l.project_calendar=new i.CalendarView(p),l.project_calendar_entry=new i.CalendarEntryView(p),l.project_files=new i.FilesView(p),l.project_file=new i.FileView(p),d=o.extend({mydata:a.mydata},p),l.project_time_entries=new i.TimeEntriesView(d),l.todo_time_entries=new i.TodoTimeEntriesView(d),l.project_post_comments=new i.PostCommentsView(p),l.project_calendar_entry_comments=new i.CalendarEntryCommentsView(p),l.todo=function(e,o){return l.todo[o.id]||(l.todo[o.id]=new i.TodoView({model:o,collections:m,project_id:e})),l.todo[o.id]},_=o.extend({todo:l.todo},p),l.project_todo_lists=new i.TodoListsView(_),l.project_todo_list=new i.TodoListView(_),l.project_todo_item=new i.TodoItemView(_),l.project_todo_item_comments=new i.TodoItemCommentsView(_),y.on("route",function(t,r){var c,n;if(o.contains(["projects","companies","people","time_report","todos"],t))l.current=l[t].render();else if(o.contains(["project_people","project_categories","project_time_entries","project_posts","project_files","project_calendar","project_todo_lists"],t))c=parseInt(r[0],10),f(c,m.projects,l[t]),l[t].collection=m[t].get_or_create(c),l.current=l[t].render();else if(o.contains(["project_person","project_post","project_file","project_calendar_entry","project_category","project_todo_list","project_calendar_entry_comments","project_post_comments","todo_time_entries"],t)){switch(c=parseInt(r[0],10),n=parseInt(r[1],10),f(c,m.projects,l[t]),l[t].cur_item=n,t){case"project_person":l[t].collection=m.project_people.get_or_create(c);break;case"project_calendar_entry":l[t].collection=m.project_calendar.get_or_create(c);break;case"project_category":l[t].collection=m.project_categories.get_or_create(c);break;case"project_post":case"project_file":case"project_todo_list":l[t].collection=m[t+"s"].get_or_create(c);break;default:l[t].collection=m[t].get_or_create(n)}l.current=l[t].render()}l.current&&(document.title=l.current.PageTitle()),l.current&&l.current.deps&&l.current.deps(),e(o.filter(e(".navbar ul.nav li").removeClass("active"),function(o){return e(o).find("a:visible")[0]&&-1!==document.location.hash.indexOf(e(o).find("a:visible")[0].hash)})).addClass("active"),e(o.filter(e("div.content ul.projectnav li").removeClass("active"),function(o){return e(o).find("a:visible")[0]&&-1!==document.location.hash.indexOf(e(o).find("a:visible")[0].hash)})).filter(":last").addClass("active")}).on("route:project_todo_item",function(e,o,t){f(e,m.projects,l.project_todo_item),l.project_todo_item.cur_item=o,l.project_todo_item.todo_item=t,l.project_todo_item.collection=l.project_todo_item.todo_lists=m.project_todo_lists.get_or_create(e),l.current=l.project_todo_item.render()}).on("route:project_todo_item_comments",function(e,o,t){f(e,m.projects,l.project_todo_item_comments),l.project_todo_item_comments.cur_item=o,l.project_todo_item_comments.todo_item=t,l.project_todo_item_comments.todo_lists=m.project_todo_lists.get_or_create(e),l.project_todo_item_comments.collection=m.project_todo_item_comments.get_or_create(t),l.current=l.project_todo_item_comments.render()}).on("route:project",function(e){f(e,m.projects,l.project_view),l.current=l.project_view.render()}).on("route:company",function(e){f(e,m.companies,l.company_view),l.current=l.company_view.render()}).on("route:person",function(e){f(e,m.people,l.person_view),l.current=l.person_view.render()}).on("route:me",function(){l.person_view.model=a.mydata,l.current=l.person_view.render()}).on("route:defaultRoute",function(){this.navigate("projects",{trigger:!0})}),l.navbar=new i.NavView({model:a.mydata,el:".navbar"}).render(),a.mydata.once("sync",function(){t.history.start()}),a.mydata.fetch(),{models:a,collections:m,views:l,workspace:y}});