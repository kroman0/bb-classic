!function(e,o){"use strict";"function"==typeof e.define&&e.define.amd?e.define("bbmain",["underscore","backbone","bbmodels","bbcollections","bbviews","backboneanalytics"],o):e.BB=o(e._,e.Backbone,e.bbmodels,e.bbcollections,e.bbviews)}(this,function(e,o,t,c,r){"use strict";var n,i,s={},p={},_={},d={className:"content",collections:p},m=o.Router.extend({routes:{projects:"projects","projects:tab":"projects","projects/:id":"project","projects/:id/todo_lists":"project_todo_lists","projects/:id/todo_lists/:tlid":"project_todo_list","projects/:id/todo_lists/:tlid/:tiid":"project_todo_item","projects/:id/todo_lists/:tlid/:tiid/comments":"project_todo_item_comments","projects/:id/time_entries/todo_items/:tiid":"todo_time_entries","projects/:id/time_entries":"project_time_entries","projects/:id/people":"project_people","projects/:id/people/:pid":"project_person","projects/:id/posts":"project_posts","projects/:id/posts/:pid":"project_post","projects/:id/posts/:pid/comments":"project_post_comments","projects/:id/files":"project_files","projects/:id/files/:fid":"project_file","projects/:id/calendar":"project_calendar","projects/:id/calendar/:cid":"project_calendar_entry","projects/:id/calendar/:cid/comments":"project_calendar_entry_comments","projects/:id/categories":"project_categories","projects/:id/categories/:cid":"project_category",companies:"companies","companies/:id":"company",people:"people","people:tab":"people","people/:id":"person",me:"me",todos:"todos",time_report:"time_report","*actions":"defaultRoute"}}),a=function(e,o,t){return o.get(e)?t.model=o.get(e):t.model.id=e,t.model},l=function(e){o.$(".container").empty().append(e.render().el)},j=new m;return s.mydata=new t.MyModel,s.project=new t.Project,s.company=new t.Company,s.person=new t.Person,p.projects=new c.Projects,p.companies=new c.Companies,p.people=new c.People,p.todos=new c.TodoLists,p.times=new c.TimeEntries,_.projects=new r.ProjectsView(e.extend({collection:p.projects},d)),_.companies=new r.CompaniesView(e.extend({collection:p.companies},d)),_.people=new r.AllPeopleView(e.extend({collection:p.people},d)),_.time_report=new r.TimeReportView(e.extend({collection:p.times},d)),_.todos=new r.TodosView(e.extend({collection:p.todos,mydata:s.mydata},d)),p.project_people=new c.People,p.project_categories=new c.Categories,p.project_posts=new c.Posts,p.project_files=new c.Attachments,p.project_todo_lists=new c.TodoLists,p.project_calendar=new c.Calendar,p.project_time_entries=new c.TimeEntries,p.todo_items=new c.TodoItems,p.todo_time_entries=new c.TodoTimeEntries,p.project_todo_item_comments=new c.TodoComments,p.project_post_comments=new c.PostComments,p.project_calendar_entry_comments=new c.CalendarEntryComments,_.company_view=new r.CompanyView(e.extend({model:s.company},d)),_.person_view=new r.AllPersonView(e.extend({model:s.person},d)),n=e.extend({model:s.project},d),_.project_view=new r.ProjectView(n),_.project_people=new r.PeopleView(n),_.project_person=new r.PersonView(n),_.project_categories=new r.CategoriesView(n),_.project_category=new r.CategoryView(n),_.project_posts=new r.PostsView(n),_.project_post=new r.PostView(n),_.project_calendar=new r.CalendarView(n),_.project_calendar_entry=new r.CalendarEntryView(n),_.project_files=new r.FilesView(n),_.project_file=new r.FileView(n),i=e.extend({mydata:s.mydata},n),_.project_time_entries=new r.TimeEntriesView(i),_.todo_time_entries=new r.TodoTimeEntriesView(i),_.project_post_comments=new r.PostCommentsView(n),_.project_calendar_entry_comments=new r.CalendarEntryCommentsView(n),_.project_todo_lists=new r.TodoListsView(n),_.project_todo_list=new r.TodoListView(n),_.project_todo_item=new r.TodoItemView(n),_.project_todo_item_comments=new r.TodoItemCommentsView(n),j.on("route",function(o,t){var c,r;if(e.contains(["projects","companies","people","time_report","todos"],o))l(_[o]);else if(e.contains(["project_people","project_categories","project_time_entries","project_posts","project_files","project_calendar","project_todo_lists"],o))c=parseInt(t[0],10),a(c,p.projects,_[o]),_[o].collection=p[o].get_or_create(c),l(_[o]);else if(e.contains(["project_person","project_post","project_file","project_calendar_entry","project_category","project_todo_list","project_calendar_entry_comments","project_post_comments","todo_time_entries"],o)){switch(c=parseInt(t[0],10),r=parseInt(t[1],10),a(c,p.projects,_[o]),_[o].cur_item=r,o){case"project_person":_[o].collection=p.project_people.get_or_create(c);break;case"project_calendar_entry":_[o].collection=p.project_calendar.get_or_create(c);break;case"project_category":_[o].collection=p.project_categories.get_or_create(c);break;case"project_post":case"project_file":case"project_todo_list":_[o].collection=p[o+"s"].get_or_create(c);break;default:_[o].collection=p[o].get_or_create(r)}l(_[o])}}).on("route:project_todo_item",function(e,o,t){a(e,p.projects,_.project_todo_item),_.project_todo_item.cur_item=o,_.project_todo_item.todo_item=t,_.project_todo_item.collection=_.project_todo_item.todo_lists=p.project_todo_lists.get_or_create(e),l(_.project_todo_item)}).on("route:project_todo_item_comments",function(e,o,t){a(e,p.projects,_.project_todo_item_comments),_.project_todo_item_comments.cur_item=o,_.project_todo_item_comments.todo_item=t,_.project_todo_item_comments.todo_lists=p.project_todo_lists.get_or_create(e),_.project_todo_item_comments.collection=p.project_todo_item_comments.get_or_create(t),l(_.project_todo_item_comments)}).on("route:project",function(e){a(e,p.projects,_.project_view),l(_.project_view)}).on("route:company",function(e){a(e,p.companies,_.company_view),l(_.company_view)}).on("route:person",function(e){a(e,p.people,_.person_view),l(_.person_view)}).on("route:me",function(){_.person_view.model=s.mydata,l(_.person_view)}).on("route:defaultRoute",function(){this.navigate("projects",{trigger:!0})}),_.navbar=new r.NavView({model:s.mydata,el:".navbar"}).render(),s.mydata.once("sync",function(){o.history.start()}),s.mydata.fetch(),{models:s,collections:p,views:_,workspace:j}});