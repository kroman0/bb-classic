!function(e,t){"use strict";if(typeof e.define==="function"&&e.define.amd){e.define("bbmain",["jquery","underscore","backbone","bbgeneral","bbmodels","bbcollections","bbviews","backboneanalytics"],t)}else{e.BB=t(e.jQuery,e._,e.Backbone,e.bbgeneral,e.bbmodels,e.bbcollections,e.bbviews)}}(this,function(e,t,o,r,n,c,i){"use strict";var s,p={},_={},d={},a=r.onReset,m={el:".content",collections:_},l,j,w,u=o.Router.extend({routes:{projects:"projects","projects:tab":"projects","projects/:id":"project","projects/:id/todo_lists":"project_todo_lists","projects/:id/todo_lists/:tlid":"project_todo_list","projects/:id/todo_lists/:tlid/:tiid":"project_todo_item","projects/:id/todo_lists/:tlid/:tiid/comments":"project_todo_item_comments","projects/:id/time_entries/todo_items/:tiid":"todo_time_entries","projects/:id/time_entries":"project_time_entries","projects/:id/people":"project_people","projects/:id/posts":"project_posts","projects/:id/posts/:pid":"project_post","projects/:id/posts/:pid/comments":"project_post_comments","projects/:id/files":"project_files","projects/:id/files/:fid":"project_file","projects/:id/calendar":"project_calendar","projects/:id/calendar/:cid":"project_calendar_entry","projects/:id/calendar/:cid/comments":"project_calendar_entry_comments","projects/:id/categories":"project_categories","projects/:id/categories/:cid":"project_category",companies:"companies","companies/:id":"company",people:"people","people:tab":"people","people/:id":"person",me:"me",todos:"todos",time_report:"time_report","*actions":"defaultRoute"}}),f=function(e,t,o){if(t.get(e)){o.model=t.get(e)}else{o.model.id=e}return o.model},y=new u;p.mydata=new n.MyModel;p.project=new n.Project;p.company=new n.Company;p.person=new n.Person;_.projects=new c.Projects;_.companies=new c.Companies;_.people=new c.People;_.todos=new c.TodoLists;_.times=new c.TimeEntries;d.current=null;d.projects=new i.ProjectsView(t.extend({collection:_.projects},m));d.companies=new i.CompaniesView(t.extend({collection:_.companies},m));d.people=new i.AllPeopleView(t.extend({collection:_.people},m));d.time_report=new i.TimeReportView(t.extend({collection:_.times},m));d.todos=new i.TodosView(t.extend({collection:_.todos,mydata:p.mydata},m));for(s in _){if(_.hasOwnProperty(s)){_[s].on("reset",a)}}_.project_people=new c.People;_.project_categories=new c.Categories;_.project_posts=new c.Posts;_.project_files=new c.Attachments;_.project_todo_lists=new c.TodoLists;_.project_calendar=new c.Calendar;_.project_time_entries=new c.TimeEntries;_.todo_items=new c.TodoItems;_.todo_time_entries=new c.TodoTimeEntries;_.project_todo_item_comments=new c.TodoComments;_.project_post_comments=new c.PostComments;_.project_calendar_entry_comments=new c.CalendarEntryComments;d.company_view=new i.CompanyView(t.extend({model:p.company},m));d.person_view=new i.PersonView(t.extend({model:p.person},m));l=t.extend({model:p.project},m);d.project_view=new i.ProjectView(l);d.project_people=new i.PeopleView(l);d.project_categories=new i.CategoriesView(l);d.project_category=new i.CategoryView(l);d.project_posts=new i.PostsView(l);d.project_post=new i.PostView(l);d.project_calendar=new i.CalendarView(l);d.project_calendar_entry=new i.CalendarEntryView(l);d.project_files=new i.FilesView(l);d.project_file=new i.FileView(l);w=t.extend({mydata:p.mydata},l);d.project_time_entries=new i.TimeEntriesView(w);d.todo_time_entries=new i.TodoTimeEntriesView(w);d.project_post_comments=new i.PostCommentsView(l);d.project_calendar_entry_comments=new i.CalendarEntryCommentsView(l);d.todo=function(e,t){if(!d.todo[t.id]){d.todo[t.id]=new i.TodoView({model:t,collections:_,project_id:e})}return d.todo[t.id]};j=t.extend({todo:d.todo},l);d.project_todo_lists=new i.TodoListsView(j);d.project_todo_list=new i.TodoListView(j);d.project_todo_item=new i.TodoItemView(j);d.project_todo_item_comments=new i.TodoItemCommentsView(j);y.on("route",function(o,r){var n,c;if(t.contains(["projects","companies","people","time_report","todos"],o)){d.current=d[o].render()}else if(t.contains(["project_people","project_categories","project_time_entries","project_posts","project_files","project_calendar","project_todo_lists"],o)){n=parseInt(r[0],10);f(n,_.projects,d[o]);d[o].collection=_[o].get_or_create(n);d.current=d[o].render()}else if(t.contains(["project_post","project_file","project_calendar_entry","project_category","project_todo_list","project_calendar_entry_comments","project_post_comments","todo_time_entries"],o)){n=parseInt(r[0],10);c=parseInt(r[1],10);f(n,_.projects,d[o]);d[o].cur_item=c;switch(o){case"project_calendar_entry":d[o].collection=_.project_calendar.get_or_create(n);break;case"project_category":d[o].collection=_.project_categories.get_or_create(n);break;case"project_post":case"project_file":case"project_todo_list":d[o].collection=_[o+"s"].get_or_create(n);break;default:d[o].collection=_[o].get_or_create(c)}d.current=d[o].render()}if(d.current){document.title=d.current.PageTitle()}if(d.current&&d.current.deps){d.current.deps()}e(t.filter(e(".navbar ul.nav li").removeClass("active"),function(t){return e(t).find("a:visible")[0]&&document.location.hash.indexOf(e(t).find("a:visible")[0].hash)!==-1})).addClass("active");e(t.filter(e("div.content ul.projectnav li").removeClass("active"),function(t){return e(t).find("a:visible")[0]&&document.location.hash.indexOf(e(t).find("a:visible")[0].hash)!==-1})).filter(":last").addClass("active")}).on("route:project_todo_item",function(e,t,o){f(e,_.projects,d.project_todo_item);d.project_todo_item.cur_item=t;d.project_todo_item.todo_item=o;d.project_todo_item.collection=d.project_todo_item.todo_lists=_.project_todo_lists.get_or_create(e);d.current=d.project_todo_item.render()}).on("route:project_todo_item_comments",function(e,t,o){f(e,_.projects,d.project_todo_item_comments);d.project_todo_item_comments.cur_item=t;d.project_todo_item_comments.todo_item=o;d.project_todo_item_comments.todo_lists=_.project_todo_lists.get_or_create(e);d.project_todo_item_comments.collection=_.project_todo_item_comments.get_or_create(o);d.current=d.project_todo_item_comments.render()}).on("route:project",function(e){f(e,_.projects,d.project_view);d.current=d.project_view.render()}).on("route:company",function(e){f(e,_.companies,d.company_view);d.current=d.company_view.render()}).on("route:person",function(e){f(e,_.people,d.person_view);d.current=d.person_view.render()}).on("route:me",function(){d.person_view.model=p.mydata;d.current=d.person_view.render()}).on("route:defaultRoute",function(){this.navigate("projects",{trigger:true})});d.navbar=new i.NavView({model:p.mydata,el:".navbar"}).render();p.mydata.once("sync",function(){o.history.start()});p.mydata.fetch();return{models:p,collections:_,views:d,workspace:y}});