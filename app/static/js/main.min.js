!function(e,t){"use strict";"function"==typeof e.define&&e.define.amd?e.define("bbmain",["jquery","underscore","backbone","bbgeneral","bbmodels","bbcollections","bbviews","backboneanalytics"],t):e.BB=t(e.jQuery,e._,e.Backbone,e.bbgeneral,e.bbmodels,e.bbcollections,e.bbviews)}(this,function(e,t,o,r,c,n,i){"use strict";var s,p,_,d={},a={},m={},l=r.onReset,j={el:".content",collections:a},w=o.Router.extend({routes:{projects:"projects","projects:tab":"projects","projects/:id":"project","projects/:id/todo_lists":"project_todo_lists","projects/:id/todo_lists/:tlid":"project_todo_list","projects/:id/todo_lists/:tlid/:tiid":"project_todo_item","projects/:id/todo_lists/:tlid/:tiid/comments":"project_todo_item_comments","projects/:id/time_entries/todo_items/:tiid":"todo_time_entries","projects/:id/time_entries":"project_time_entries","projects/:id/people":"project_people","projects/:id/people/:pid":"project_person","projects/:id/posts":"project_posts","projects/:id/posts/:pid":"project_post","projects/:id/posts/:pid/comments":"project_post_comments","projects/:id/files":"project_files","projects/:id/files/:fid":"project_file","projects/:id/calendar":"project_calendar","projects/:id/calendar/:cid":"project_calendar_entry","projects/:id/calendar/:cid/comments":"project_calendar_entry_comments","projects/:id/categories":"project_categories","projects/:id/categories/:cid":"project_category",companies:"companies","companies/:id":"company",people:"people","people:tab":"people","people/:id":"person",me:"me",todos:"todos",time_report:"time_report","*actions":"defaultRoute"}}),u=function(e,t,o){return t.get(e)?o.model=t.get(e):o.model.id=e,o.model},f=new w;d.mydata=new c.MyModel,d.project=new c.Project,d.company=new c.Company,d.person=new c.Person,a.projects=new n.Projects,a.companies=new n.Companies,a.people=new n.People,a.todos=new n.TodoLists,a.times=new n.TimeEntries,m.current=null,m.projects=new i.ProjectsView(t.extend({collection:a.projects},j)),m.companies=new i.CompaniesView(t.extend({collection:a.companies},j)),m.people=new i.AllPeopleView(t.extend({collection:a.people},j)),m.time_report=new i.TimeReportView(t.extend({collection:a.times},j)),m.todos=new i.TodosView(t.extend({collection:a.todos,mydata:d.mydata},j));for(s in a)a.hasOwnProperty(s)&&a[s].on("reset",l);return a.project_people=new n.People,a.project_categories=new n.Categories,a.project_posts=new n.Posts,a.project_files=new n.Attachments,a.project_todo_lists=new n.TodoLists,a.project_calendar=new n.Calendar,a.project_time_entries=new n.TimeEntries,a.todo_items=new n.TodoItems,a.todo_time_entries=new n.TodoTimeEntries,a.project_todo_item_comments=new n.TodoComments,a.project_post_comments=new n.PostComments,a.project_calendar_entry_comments=new n.CalendarEntryComments,m.company_view=new i.CompanyView(t.extend({model:d.company},j)),m.person_view=new i.AllPersonView(t.extend({model:d.person},j)),p=t.extend({model:d.project},j),m.project_view=new i.ProjectView(p),m.project_people=new i.PeopleView(p),m.project_person=new i.PersonView(p),m.project_categories=new i.CategoriesView(p),m.project_category=new i.CategoryView(p),m.project_posts=new i.PostsView(p),m.project_post=new i.PostView(p),m.project_calendar=new i.CalendarView(p),m.project_calendar_entry=new i.CalendarEntryView(p),m.project_files=new i.FilesView(p),m.project_file=new i.FileView(p),_=t.extend({mydata:d.mydata},p),m.project_time_entries=new i.TimeEntriesView(_),m.todo_time_entries=new i.TodoTimeEntriesView(_),m.project_post_comments=new i.PostCommentsView(p),m.project_calendar_entry_comments=new i.CalendarEntryCommentsView(p),m.project_todo_lists=new i.TodoListsView(p),m.project_todo_list=new i.TodoListView(p),m.project_todo_item=new i.TodoItemView(p),m.project_todo_item_comments=new i.TodoItemCommentsView(p),f.on("route",function(o,r){var c,n;if(t.contains(["projects","companies","people","time_report","todos"],o))m.current=m[o].render();else if(t.contains(["project_people","project_categories","project_time_entries","project_posts","project_files","project_calendar","project_todo_lists"],o))c=parseInt(r[0],10),u(c,a.projects,m[o]),m[o].collection=a[o].get_or_create(c),m.current=m[o].render();else if(t.contains(["project_person","project_post","project_file","project_calendar_entry","project_category","project_todo_list","project_calendar_entry_comments","project_post_comments","todo_time_entries"],o)){switch(c=parseInt(r[0],10),n=parseInt(r[1],10),u(c,a.projects,m[o]),m[o].cur_item=n,o){case"project_person":m[o].collection=a.project_people.get_or_create(c);break;case"project_calendar_entry":m[o].collection=a.project_calendar.get_or_create(c);break;case"project_category":m[o].collection=a.project_categories.get_or_create(c);break;case"project_post":case"project_file":case"project_todo_list":m[o].collection=a[o+"s"].get_or_create(c);break;default:m[o].collection=a[o].get_or_create(n)}m.current=m[o].render()}m.current&&(document.title=m.current.PageTitle()),m.current&&m.current.deps&&m.current.deps(),e(t.filter(e(".navbar ul.nav li").removeClass("active"),function(t){return e(t).find("a:visible")[0]&&-1!==document.location.hash.indexOf(e(t).find("a:visible")[0].hash)})).addClass("active"),e(t.filter(e("div.content ul.projectnav li").removeClass("active"),function(t){return e(t).find("a:visible")[0]&&-1!==document.location.hash.indexOf(e(t).find("a:visible")[0].hash)})).filter(":last").addClass("active")}).on("route:project_todo_item",function(e,t,o){u(e,a.projects,m.project_todo_item),m.project_todo_item.cur_item=t,m.project_todo_item.todo_item=o,m.project_todo_item.collection=m.project_todo_item.todo_lists=a.project_todo_lists.get_or_create(e),m.current=m.project_todo_item.render()}).on("route:project_todo_item_comments",function(e,t,o){u(e,a.projects,m.project_todo_item_comments),m.project_todo_item_comments.cur_item=t,m.project_todo_item_comments.todo_item=o,m.project_todo_item_comments.todo_lists=a.project_todo_lists.get_or_create(e),m.project_todo_item_comments.collection=a.project_todo_item_comments.get_or_create(o),m.current=m.project_todo_item_comments.render()}).on("route:project",function(e){u(e,a.projects,m.project_view),m.current=m.project_view.render()}).on("route:company",function(e){u(e,a.companies,m.company_view),m.current=m.company_view.render()}).on("route:person",function(e){u(e,a.people,m.person_view),m.current=m.person_view.render()}).on("route:me",function(){m.person_view.model=d.mydata,m.current=m.person_view.render()}).on("route:defaultRoute",function(){this.navigate("projects",{trigger:!0})}),m.navbar=new i.NavView({model:d.mydata,el:".navbar"}).render(),d.mydata.once("sync",function(){o.history.start()}),d.mydata.fetch(),{models:d,collections:a,views:m,workspace:f}});