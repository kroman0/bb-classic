!function(e,t){"use strict";if(typeof e.define==="function"&&e.define.amd){e.define("bbcollections",["underscore","backbone","backbonepageable","bbgeneral","bbmodels"],t)}else{e.bbcollections=t(e._,e.Backbone,e.Backbone.PageableCollection,e.bbgeneral,e.bbmodels)}}(this,function(e,t,i,n,r){"use strict";var s={},o=n.onReset,l={fetchonce:function(){var e=this.fetched;if(!e){this.fetched=true;this.fetch({cache:true,reset:true})}return e},get_or_create:function(e){if(!this[e]){this[e]=this.clone();this[e].parent_id=e;this[e].on("reset",o)}return this[e]}},a=t.Collection.extend(l),p=i.extend(l),d=a.extend({parent_id:null}),m=p.extend({mode:"client",parent_id:null});s.Projects=a.extend({url:"/api/projects.xml",model:r.Project});s.Companies=a.extend({url:"/api/companies.xml",model:r.Company});s.People=d.extend({url:function(){return e.isFinite(this.parent_id)?"/api/projects/"+this.parent_id+"/people.xml":"/api/people.xml"},model:r.Person});s.Posts=d.extend({url:function(){return"/api/projects/"+this.parent_id+"/posts.xml"},model:r.Post});s.Attachments=m.extend({url:function(){return"/api/projects/"+this.parent_id+"/attachments.xml"},model:r.Attachment});s.Calendar=d.extend({url:function(){return"/api/projects/"+this.parent_id+"/calendar_entries.xml"},model:r.CalendarEntry});s.Categories=m.extend({url:function(){return"/api/projects/"+this.parent_id+"/categories.xml"},model:r.Category});s.TimeEntries=m.extend({parent:"projects",filter_report:null,url:function(){if(e.isFinite(this.parent_id)){return"/api/"+this.parent+"/"+this.parent_id+"/time_entries.xml"}if(this.filter_report){return"/api/time_entries/report.xml?"+this.filter_report}return"/api/time_entries/report.xml"},model:r.TimeEntry});s.TodoTimeEntries=s.TimeEntries.extend({parent:"todo_items"});s.TodoItems=d.extend({url:function(){return"/api/todo_lists/"+this.parent_id+"/todo_items.xml"},model:r.TodoItem});s.TodoLists=d.extend({responsible_party:null,filter_status:null,url:function(){if(e.isFinite(this.parent_id)&&this.filter_status){return"/api/projects/"+this.parent_id+"/todo_lists.xml?filter="+this.filter_status}if(e.isFinite(this.parent_id)){return"/api/projects/"+this.parent_id+"/todo_lists.xml"}if(this.responsible_party===null){return"/api/todo_lists.xml"}if(this.responsible_party===""){return"/api/todo_lists.xml?responsible_party="}return"/api/todo_lists.xml?responsible_party="+this.responsible_party},model:r.TodoList});s.PostComments=d.extend({parent_type:"posts",url:function(){return"/api/"+this.parent_type+"/"+this.parent_id+"/comments.xml"},model:r.Comment});s.TodoComments=s.PostComments.extend({parent_type:"todo_items"});s.CalendarEntryComments=s.PostComments.extend({parent_type:"milestones"});return s});