!function(){"use strict";var bbcollections=window.bbcollections={},bbmodels=window.bbmodels,onReset=window.onReset,BBCollectionExtra={fetchonce:function(){var fetched=this.fetched;if(!fetched){this.fetched=true;this.fetch({cache:true})}return fetched},get_or_create:function(id){if(!this[id]){this[id]=this.clone();this[id].parent_id=id;this[id].on("reset",onReset);this[id].on("sync",onReset)}return this[id]}},BBCollection=Backbone.Collection.extend(BBCollectionExtra),BBPCollection=Backbone.PageableCollection.extend(BBCollectionExtra),PBBCollection=BBCollection.extend({parent_id:null}),PBBPCollection=BBPCollection.extend({mode:"client",parent_id:null});bbcollections.Projects=BBCollection.extend({url:"/api/projects.xml",model:bbmodels.Project});bbcollections.Companies=BBCollection.extend({url:"/api/companies.xml",model:bbmodels.Company});bbcollections.People=PBBCollection.extend({url:function(){return _.isFinite(this.parent_id)?"/api/projects/"+this.parent_id+"/people.xml":"/api/people.xml"},model:bbmodels.Person});bbcollections.Posts=PBBCollection.extend({url:function(){return"/api/projects/"+this.parent_id+"/posts.xml"},model:bbmodels.Post});bbcollections.Attachments=PBBPCollection.extend({url:function(){return"/api/projects/"+this.parent_id+"/attachments.xml"},model:bbmodels.Attachment});bbcollections.Calendar=PBBCollection.extend({url:function(){return"/api/projects/"+this.parent_id+"/calendar_entries.xml"},model:bbmodels.CalendarEntry});bbcollections.Categories=PBBPCollection.extend({url:function(){return"/api/projects/"+this.parent_id+"/categories.xml"},model:bbmodels.Category});bbcollections.TimeEntries=PBBPCollection.extend({parent:"projects",filter_report:null,url:function(){if(_.isFinite(this.parent_id)){return"/api/"+this.parent+"/"+this.parent_id+"/time_entries.xml"}if(this.filter_report){return"/api/time_entries/report.xml?"+this.filter_report}return"/api/time_entries/report.xml"},model:bbmodels.TimeEntry});bbcollections.TodoTimeEntries=bbcollections.TimeEntries.extend({parent:"todo_items"});bbcollections.TodoItems=PBBCollection.extend({url:function(){return"/api/todo_lists/"+this.parent_id+"/todo_items.xml"},model:bbmodels.TodoItem});bbcollections.TodoLists=PBBCollection.extend({responsible_party:null,filter_status:null,url:function(){if(_.isFinite(this.parent_id)&&this.filter_status){return"/api/projects/"+this.parent_id+"/todo_lists.xml?filter="+this.filter_status}if(_.isFinite(this.parent_id)){return"/api/projects/"+this.parent_id+"/todo_lists.xml"}if(this.responsible_party===null){return"/api/todo_lists.xml"}if(this.responsible_party===""){return"/api/todo_lists.xml?responsible_party="}return"/api/todo_lists.xml?responsible_party="+this.responsible_party},model:bbmodels.TodoList});bbcollections.PostComments=PBBCollection.extend({parent_type:"posts",url:function(){return"/api/"+this.parent_type+"/"+this.parent_id+"/comments.xml"},model:bbmodels.Comment});bbcollections.TodoComments=bbcollections.PostComments.extend({parent_type:"todo_items"});bbcollections.CalendarEntryComments=bbcollections.PostComments.extend({parent_type:"milestones"})}();